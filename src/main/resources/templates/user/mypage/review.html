<html th:replace="~{/layouts/base :: layout(~{::main}, ~{::link}, ~{::script})}"
      xmlns:th="http://www.thymeleaf.org">
<head>
  <link rel="stylesheet" th:href="@{/css/common/page.css}">
  <link rel="stylesheet" th:href="@{/css/common/item-card.css}">
  <link rel="stylesheet" th:href="@{/css/common/board.css}">
  <link rel="stylesheet" th:href="@{/css/user/order/reviewModal.css}">

</head>
  <main>
    <div class="page-wrapper">
      <section>
        <div class="page-title">
          <h1>리뷰조회</h1>
        </div>
        <div class="filter-wrapper">
          <ul>
            <li>
              <a th:href="|@{/mypage/review}|">
                작성 대기
              </a>
            </li>
            <li>
              <a th:classappend="${#strings.equals(param.status,'Y')} ? 'active'" th:href="|@{/mypage/review(status=Y)}|">
                작성 완료
              </a>
            </li>
          </ul>
        </div>

      <div class="page-container">
        <div class="page-content">
          <h2 class="sr-only">구매 목록</h2>
          <div class="item-cards">

            <th:block th:unless="${!list.isEmpty()} or ${list.size()} > 0 ">
              <p class="no-list"> 없습니다. </p>
            </th:block>

            <div class="item" th:each="funding : ${list}">

              <th:block th:if="${funding.reviewCode == null}">
                <a th:href="@{/mypage/purchase-funding/{id}(id=${funding.orderCode})}" class="card">
                  <div class="thumb" th:style="'background-image: url('+@{/fundingImg/}+${funding.mainFile}+')'" ></div>
                  <article>
                    <h1 th:text="${funding.fundingTitle}">item1</h1>
                    <p th:text="${funding.fundingSummary}">설명</p>
                    <span>content1</span>
                  </article>
                </a>
              </th:block>

                <th:block th:unless="${funding.reviewCode == null}">
                  <a class="card">
                  <div class="thumb" th:style="'background-image: url('+@{/fundingImg/}+${funding.mainFile}+')'" ></div>
                  <article>
                    <h1 th:text="${funding.fundingTitle}">item1</h1>
                    <p th:text="${funding.fundingSummary}">설명</p>
                    <span th:onclick="|reivewList(${funding.reviewCode})|">작성한 리뷰 확인</span>
                  </article>
                </a>
              </th:block>
            </div>
          </div>
        </div>
        <div class="reviewmodal">
          <div class="modal-container">
            <div class="modal-content">
              <span class="review-close">&times;</span>
              <h2 class="modal-title">작성한리뷰</h2>
              <form class="mb-3 reviewform" name="reviewform" id="reviewform" method="post">
                <fieldset>
                  <span class="text-bold">별점 :</span>
                  <span type="text" id="rate"></span>
                </fieldset>
                <div>
                  <textarea class="reviewContents" type="text" id="" placeholder="최소10이상 작성해주세요!!" maxlength="3000"></textarea>
                </div>
                <div class="file-container">
                  <div class="reviewDiv"></div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>
</main>
<script>
  const review = document.querySelector(".reviewmodal");
  const btn = document.querySelector(".reviewBtn");
  const reviewClose = document.querySelector(".review-close");

  reviewClose.addEventListener('click', closeReviewModal);

  function openReviewModal() {
    review.style.display = "block";
    review.animate([{opacity: 0}, {opacity: 1}], {duration: 300, fill: "forwards"});
  }

  function closeReviewModal() {
    review.animate([{opacity: 1}, {opacity: 0}], {duration: 300, fill: "forwards"}).onfinish = function() {
      review.style.display = "none";
      const $img = document.querySelector(".reviewDiv");
      if($img.hasChildNodes()){
        $img.replaceChildren();
      }
    };
  }
</script>
<script>
  function reivewList(code){
    $.ajax({
      url: '/write/review/list',
      method: 'get',
      data: {'reviewCode' : code},
      dataType:'json',
      success: function (data){
        console.log(data);
        $('.reviewContents').text(data.reviewContent);
        $('#rate').text(data.reviewStar);
        openReviewModal();
      },
      error: function (data){
        console.log(data);
      }

    })
  }
</script>
</html>